#post-processing and maps
map_plot <-function (variable){
p1 <-model_out_estimate %>%
filter(name == variable) %>%
ggplot()+
geom_tile(aes(x=x,y=y, fill = value))+
geom_point(data =model_out_pval %>%
filter(name == variable) ,aes(x=x,y=y),
color = "black",
size = 0.0001,
alpha = 0.5)+
geom_sf(data = world, fill = "transparent", colour = "black")+
coord_sf(xlim = c(-10, 45), ylim = c(30, 73), expand = FALSE)+
theme_bw()+
ggtitle(label = variable)+
ylab("")+
xlab("")+
scale_fill_continuous_diverging("Blue-Red 3")+
theme(element_blank(),
legend.title=element_blank())
}
#======================================================================
NEU_crop_df <-mask_nc(model_out_nc,NEU_mask_crop) %>%
mutate(Climate_zone = "NEU",
Land_cover  = "Crop")
WCE_crop_df <-mask_nc(model_out_nc,WCE_mask_crop) %>%
mutate(Climate_zone = "WCE",
Land_cover  = "Crop")
MED_crop_df <-mask_nc(model_out_nc,MED_mask_crop) %>%
mutate(Climate_zone = "MED",
Land_cover  = "Crop")
NEU_forest_df <-mask_nc(model_out_nc,NEU_mask_forest) %>%
mutate(Climate_zone = "NEU",
Land_cover  = "Forest")
WCE_forest_df <-mask_nc(model_out_nc,WCE_mask_forest) %>%
mutate(Climate_zone = "WCE",
Land_cover  = "Forest")
MED_forest_df <-mask_nc(model_out_nc,MED_mask_forest) %>%
mutate(Climate_zone = "MED",
Land_cover  = "Forest")
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.)))
mean_coef <-coef_summary_df %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
group_by(Climate_zone,Land_cover,name) %>%
summarise_at(vars(value),mean) %>%
rename(mean = value)
#======================================================================
coef_plot <- function(variable){
p1 <-coef_summary_df %>%
inner_join(mean_coef) %>%
mutate(name = sub("(.*?_.*?)_.*", "\\1", name)) %>%
filter(name == variable) %>%
ggplot() +
geom_density(aes(value, fill = mean))+
facet_grid(Climate_zone~Land_cover)+
theme_bw(base_size = 15)+
ylab("")+
xlab("")+
geom_vline(xintercept = 0, linetype = "dashed", size = 1)+
scale_fill_continuous_diverging("Blue-Red 3")
}
#====
#======================================================================
var_name <-model_out_estimate$name %>%  unique()
var_name
a<-map_plot(var_name[[1]])
b<-coef_plot(var_name[[1]])
a + b
a<-map_plot(var_name[[5]])
b<-coef_plot(var_name[[5]])
a + b
var_name
a<-map_plot(var_name[[11]])
b<-coef_plot(var_name[[11]])
a + b
a<-map_plot(var_name[[12]])
b<-coef_plot(var_name[[12]])
a + b
model_out_estimate
#======================================================================
var_name <-model_out_pval$name %>%  unique()
var_name.
var_name
#Load model output as df
model_out_estimate <-list.files(dir_data, "sem_data_2", full.names = TRUE) %>%
read_stars() %>%
as.data.frame() %>%
drop_na() %>%
tibble() %>%
pivot_longer(-c(x,y)) %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?)_.*", "\\2", name))
model_out_estimate$name
#Load model output as df
model_out_estimate <-list.files(dir_data, "sem_data_2", full.names = TRUE) %>%
read_stars() %>%
as.data.frame() %>%
drop_na() %>%
tibble() %>%
pivot_longer(-c(x,y)) %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name))
model_out_estimate$name
var_name
model_out_estimate <-list.files(dir_data, "sem_data_2", full.names = TRUE) %>%
read_stars() %>%
as.data.frame() %>%
drop_na() %>%
tibble() %>%
pivot_longer(-c(x,y)) %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name))
model_out_estimate
model_out_estimate$name %>%  unique()
#Load model output as df
model_out_estimate <-list.files(dir_data, "sem_data_2", full.names = TRUE) %>%
read_stars() %>%
as.data.frame() %>%
drop_na() %>%
tibble() %>%
pivot_longer(-c(x,y)) %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
filter_at(.vars= vars(name), all_vars(!grepl('..',.)))
model_out_estimate$name %>%  unique()
#Load model output as df
model_out_estimate <-list.files(dir_data, "sem_data_2", full.names = TRUE) %>%
read_stars() %>%
as.data.frame() %>%
drop_na() %>%
tibble() %>%
pivot_longer(-c(x,y)) %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name))
model_out_estimate
model_out_estimate$name %>%  unique()
model_out_pval <-list.files(dir_data, "sem_data_2", full.names = TRUE) %>%
read_stars() %>%
as.data.frame() %>%
drop_na() %>%
tibble() %>%
pivot_longer(-c(x,y)) %>%
filter_at(.vars= vars(name), all_vars(grepl('_p.value',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
filter(value <= 0.05)
model_out_pval$name %>%  unique()
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.)))
coef_summary_df
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.)))
coef_summary_df
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name))
mean_coef <-coef_summary_df %>%
# filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
group_by(Climate_zone,Land_cover,name) %>%
summarise_at(vars(value),mean) %>%
rename(mean = value)
mean_coef
#======================================================================
coef_plot <- function(variable){
p1 <-coef_summary_df %>%
inner_join(mean_coef) %>%
# mutate(name = sub("(.*?_.*?)_.*", "\\1", name)) %>%
filter(name == variable) %>%
ggplot() +
geom_density(aes(value, fill = mean))+
facet_grid(Climate_zone~Land_cover)+
theme_bw(base_size = 15)+
ylab("")+
xlab("")+
geom_vline(xintercept = 0, linetype = "dashed", size = 1)+
scale_fill_continuous_diverging("Blue-Red 3")
}
#======================================================================
var_name <-model_out_estimate$name %>%  unique()
var_name
a<-map_plot(var_name[[1]])
b<-coef_plot(var_name[[1]])
library(patchwork)
a + b
coef_summary_df
coef_summary_df$Climate_zone %>%  levels()
coef_summary_df$Climate_zone %>%  unique()
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
mutate(Climate_zone = recode_factor(NEU = NEU,
WCE = WCE,
MED = MED))
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
mutate(Climate_zone = recode_factor(NEU = "NEU",
WCE = "WCE",
MED = "MED"))
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
mutate(Climate_zone = recode_factor("NEU" = "NEU",
"WCE" = "WCE",
"MED" = "MED"))
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
mutate(Climate_zone = recode_factor("NEU" == "NEU",
"WCE" == "WCE",
"MED" == "MED"))
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
mutate(Climate_zone = recode_factor(Climate_zone,"NEU" == "NEU",
"WCE" == "WCE",
"MED" == "MED"))
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
mutate(Climate_zone = recode_factor(Climate_zone,
NEU == "NEU",
WCE == "WCE",
MED == "MED"))
coef_summary_df <-bind_rows(NEU_crop_df,WCE_crop_df,MED_crop_df,
NEU_forest_df,WCE_forest_df,MED_forest_df) %>%
tibble() %>%
pivot_longer(-c(x,y,Climate_zone, Land_cover))  %>%
filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
mutate(name = sub("(.*?_.*?_.*?)_.*", "\\1", name)) %>%
mutate(Climate_zone = recode_factor(Climate_zone,
NEU = "NEU",
WCE = "WCE",
MED = "MED"))
mean_coef <-coef_summary_df %>%
# filter_at(.vars= vars(name), all_vars(grepl('Estimate',.))) %>%
group_by(Climate_zone,Land_cover,name) %>%
summarise_at(vars(value),mean) %>%
rename(mean = value)
#======================================================================
coef_plot <- function(variable){
p1 <-coef_summary_df %>%
inner_join(mean_coef) %>%
# mutate(name = sub("(.*?_.*?)_.*", "\\1", name)) %>%
filter(name == variable) %>%
ggplot() +
geom_density(aes(value, fill = mean))+
facet_grid(Climate_zone~Land_cover)+
theme_bw(base_size = 15)+
ylab("")+
xlab("")+
geom_vline(xintercept = 0, linetype = "dashed", size = 1)+
scale_fill_continuous_diverging("Blue-Red 3")
}
#======================================================================
var_name <-model_out_estimate$name %>%  unique()
var_name
a<-map_plot(var_name[[1]])
b<-coef_plot(var_name[[1]])
library(patchwork)
a + b
climate_zones %>%  plot()
#======================================================================
#post-processing and maps
map_plot <-function (variable){
p1 <-model_out_estimate %>%
filter(name == variable) %>%
ggplot()+
geom_tile(aes(x=x,y=y, fill = value))+
geom_point(data =model_out_pval %>%
filter(name == variable) ,aes(x=x,y=y),
color = "darkgray",
size = 0.0001,
alpha = 0.5)+
climate_zones
geom_sf(data = world, fill = "transparent", colour = "black")+
geom_sf(data = climate_zones, fill = "transparent", colour = "black")+
coord_sf(xlim = c(-10, 45), ylim = c(30, 73), expand = FALSE)+
theme_bw()+
ggtitle(label = variable)+
ylab("")+
xlab("")+
scale_fill_continuous_diverging("Blue-Red 3")+
theme(element_blank(),
legend.title=element_blank())
}
a<-map_plot(var_name[[1]])
p1 <-model_out_estimate %>%
filter(name == variable) %>%
ggplot()+
geom_tile(aes(x=x,y=y, fill = value))+
geom_point(data =model_out_pval %>%
filter(name == variable) ,aes(x=x,y=y),
color = "darkgray",
size = 0.0001,
alpha = 0.5)+
geom_sf(data = world, fill = "transparent", colour = "black")+
geom_sf(data = climate_zones, fill = "transparent", colour = "black")+
coord_sf(xlim = c(-10, 45), ylim = c(30, 73), expand = FALSE)+
theme_bw()+
ggtitle(label = variable)+
ylab("")+
xlab("")+
scale_fill_continuous_diverging("Blue-Red 3")+
theme(element_blank(),
legend.title=element_blank())
#======================================================================
#post-processing and maps
map_plot <-function (variable){
p1 <-model_out_estimate %>%
filter(name == variable) %>%
ggplot()+
geom_tile(aes(x=x,y=y, fill = value))+
geom_point(data =model_out_pval %>%
filter(name == variable) ,aes(x=x,y=y),
color = "darkgray",
size = 0.0001,
alpha = 0.5)+
geom_sf(data = world, fill = "transparent", colour = "black")+
geom_sf(data = climate_zones, fill = "transparent", colour = "black")+
coord_sf(xlim = c(-10, 45), ylim = c(30, 73), expand = FALSE)+
theme_bw()+
ggtitle(label = variable)+
ylab("")+
xlab("")+
scale_fill_continuous_diverging("Blue-Red 3")+
theme(element_blank(),
legend.title=element_blank())
}
a<-map_plot(var_name[[1]])
a
#======================================================================
#post-processing and maps
map_plot <-function (variable){
p1 <-model_out_estimate %>%
filter(name == variable) %>%
ggplot()+
geom_tile(aes(x=x,y=y, fill = value))+
geom_point(data =model_out_pval %>%
filter(name == variable) ,aes(x=x,y=y),
color = "black",
size = 0.0001,
alpha = 0.3)+
geom_sf(data = world, fill = "transparent", colour = "black")+
geom_sf(data = climate_zones, fill = "transparent", colour = "black", size = 1)+
coord_sf(xlim = c(-10, 45), ylim = c(30, 73), expand = FALSE)+
theme_bw()+
ggtitle(label = variable)+
ylab("")+
xlab("")+
scale_fill_continuous_diverging("Blue-Red 3")+
theme(element_blank(),
legend.title=element_blank())
}
a<-map_plot(var_name[[1]])
a
mask_crop
mask_forest > 0.5
mask_forest_filter <-mask_forest > 0.5
mask_forest_filter %>%  st_as_sf()
mask_forest_filter %>%  st_as_sf() %>%
filter(mask_nc == TRUE) %>%
ggplot()+
geom_sf(color = "red")
mask_forest_filter %>%  st_as_sf() %>%
# filter(mask_nc == TRUE) %>%
ggplot()+
geom_sf(aes(fill = mask_nc))
mask_forest_filter %>%  st_as_sf() %>%
# filter(mask_nc == TRUE) %>%
ggplot()+
geom_sf(aes(color = mask_nc))+
mask_forest_filter %>%  st_as_sf() %>%
# filter(mask_nc == TRUE) %>%
ggplot()+
geom_sf(aes(color = mask_nc))
mask_forest_filter %>%  st_as_sf() %>%
filter(mask_nc == TRUE) %>%
ggplot() +
geom_sf() +
geom_sf(data = world,
fill = "transparent",
colour = "black") +
geom_sf(
data = climate_zones,
fill = "transparent",
colour = "black",
size = 1
) +
coord_sf(xlim = c(-10, 45),
ylim = c(30, 73),
expand = FALSE) +
theme_bw()
mask_forest_filter %>%  st_as_sf() %>%
filter(mask_nc == TRUE) %>%
ggplot() +
geom_sf() +
geom_sf(data = world,
fill = "transparent",
colour = "black") +
geom_sf(
data = climate_zones,
fill = "transparent",
colour = "black",
size = 1
) +
ggtitle(Label = "Forest fraction > 0.5")+
coord_sf(xlim = c(-10, 45),
ylim = c(30, 73),
expand = FALSE) +
theme_bw()
mask_forest_filter %>%  st_as_sf() %>%
filter(mask_nc == TRUE) %>%
ggplot() +
geom_sf() +
geom_sf(data = world,
fill = "transparent",
colour = "black") +
geom_sf(
data = climate_zones,
fill = "transparent",
colour = "black",
size = 1
) +
ggtitle(label = "Forest fraction > 0.5")+
coord_sf(xlim = c(-10, 45),
ylim = c(30, 73),
expand = FALSE) +
theme_bw()
mask_forest_filter <-crop_forest > 0.5
mask_forest_filter %>%  st_as_sf() %>%
filter(mask_nc == TRUE) %>%
ggplot() +
geom_sf() +
geom_sf(data = world,
fill = "transparent",
colour = "black") +
geom_sf(
data = climate_zones,
fill = "transparent",
colour = "black",
size = 1
) +
ggtitle(label = "Crop fraction > 0.5")+
coord_sf(xlim = c(-10, 45),
ylim = c(30, 73),
expand = FALSE) +
theme_bw()
mask_forest_filter <-mask_crop > 0.5
mask_forest_filter %>%  st_as_sf() %>%
filter(mask_nc == TRUE) %>%
ggplot() +
geom_sf() +
geom_sf(data = world,
fill = "transparent",
colour = "black") +
geom_sf(
data = climate_zones,
fill = "transparent",
colour = "black",
size = 1
) +
ggtitle(label = "Crop fraction > 0.5")+
coord_sf(xlim = c(-10, 45),
ylim = c(30, 73),
expand = FALSE) +
theme_bw()
#======================================================================
var_name <-model_out_estimate$name %>%  unique()
var_name
var_name
a<-map_plot(var_name[[14]])
b<-coef_plot(var_name[[14]])
a + b
var_name
a<-map_plot(var_name[[12]])
b<-coef_plot(var_name[[12]])
a + b
var_name
a<-map_plot(var_name[[1]])
b<-coef_plot(var_name[[1]])
a + b
